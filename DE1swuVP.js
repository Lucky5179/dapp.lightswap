const __vite__fileDeps=["assets/index-POi8GhpC.js","assets/index-CWjS2nv2.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{cn as a,cv as b,cJ as N,cL as se,cy as ke,cA as d,cV as P,cS as Pt,cz as ne,dd as le,eY as xt,cM as Mt,di as Z,dl as Ct,cZ as Rt,dt as It,ee as Tt,du as Lt,dI as Vt,L as m,eR as Et,eK as qe,_ as j,e5 as Nt,dm as re,dk as ae,df as ue,dp as de,dq as G,dr as Be,ds as _t,dw as je,F as Dt,dC as kt,dF as qt,eU as Bt,O as Ue,__tla as jt}from"./assets/index-POi8GhpC.js";import{A as Oe}from"./BNvyzkU_.js";import{u as Ut}from"./BIRMHJJ4.js";import{L as c}from"./zJSzH3N0.js";import{u as Ot}from"./C3OMHbbi.js";import{g as Ft}from"./CGri0DVm.js";import{u as Ht}from"./CNj6CspX.js";import{c as Wt}from"./CNwSF2cA.js";import{u as $t,__tla as Yt}from"./Bm7XAPj_.js";import{v as me}from"./Bb0RDO2T.js";let Fe,He,We,$e,Ye,Kt=Promise.all([(()=>{try{return jt}catch{}})(),(()=>{try{return Yt}catch{}})()]).then(async()=>{(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new n.Error().stack;i&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[i]="40f6aa33-c3ff-4189-bb0e-f8819cd62477",n._sentryDebugIdIdentifier="sentry-dbid-40f6aa33-c3ff-4189-bb0e-f8819cd62477")}catch{}})();let ce,pe,ge,he,ie,Ae,fe,be,ye,ve,we;Fe=a.memo(({poolAsset:n,runeAsset:i,poolAssetList:s,onAssetAmountChange:p,onRuneAmountChange:e,onPoolChange:t,liquidityType:o,isAssetPending:h,isRunePending:u})=>{const{assetInputProps:S,assets:g}=Ut(s);return b.jsxs(N,{col:!0,className:"relative self-stretch w-full",children:[b.jsx(N,{className:se("absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2","p-1 md:p-2 rounded-xl md:rounded-[18px]","border-10 border-solid bg-blue dark:border-dark-border-primary border-transparent","opacity-100 scale-100 transition-all",{"!scale-0 !opacity-0":o!==c.SYMMETRICAL}),children:b.jsx(ke,{className:se("w-7 h-7"),color:"white",name:"plus"})}),b.jsx(N,{className:se("overflow-hidden h-[111px] transition-all",{"!h-[0px]":o===c.RUNE}),children:b.jsx(Oe,{hideZeroPrice:!0,...S,assets:g,className:"!mb-1 flex-1",disabled:h,maxButtonLabel:u?d("pendingLiquidity.complete"):"",onAssetChange:t,onValueChange:p,selectedAsset:n,warning:h?d("pendingLiquidity.content",{asset:P.ticker}):""})}),b.jsx(N,{className:se("overflow-hidden transition-all",{"!h-[0px]":o===c.ASSET,"h-[111px] ":o!==c.RUNE,"h-[140px] md:h-[111px]":o===c.RUNE}),children:b.jsx(Oe,{hideZeroPrice:!0,singleAsset:!0,assets:s,className:"!mb-1 flex-1",disabled:u,maxButtonLabel:h?d("pendingLiquidity.complete"):"",onAssetChange:t,onValueChange:e,poolAsset:n,selectedAsset:i,showSecondaryChainSelector:o===c.RUNE,warning:u?d("pendingLiquidity.content",{asset:n.asset.ticker}):""})})]})}),ce="gap-2 border-0 border-r border-dotted border-light-typo-gray dark:border-dark-typo-gray",He=({poolTicker:n,runeTicker:i,poolShare:s,slippage:p,fee:e,rate:t})=>{const o=[{label:`${n} ${d("common.per")} ${i}`,value:t||"N/A"},{label:d("views.wallet.slip"),value:p||"N/A"},{label:d("common.fee"),value:e||"N/A"},{label:d("views.addLiquidity.shareOfPool"),value:s||"N/A"}];return b.jsx(Pt,{className:"self-stretch !mt-0 !bg-light-bg-primary dark:!bg-dark-gray-light !rounded-2xl flex-col",shadow:!1,title:b.jsxs(N,{row:!0,className:"gap-x-2",children:[b.jsx(ke,{color:"secondary",name:"infoCircle",size:16}),b.jsx(ne,{fontWeight:"normal",textStyle:"caption",variant:"primary",children:d("views.addLiquidity.pricesAndPoolShare")})]}),children:b.jsx(N,{className:"w-full",children:o.map(({label:h,value:u},S)=>{const g=S===0,M=S===o.length-1;return b.jsxs(N,{col:!0,alignCenter:!(g||M),className:M?"text-right":ce,flex:1,justify:"between",children:[b.jsx(ne,{fontWeight:"semibold",textStyle:"caption",variant:"secondary",children:h}),b.jsx(ne,{className:"text-base md:text-h4",textStyle:"caption",children:u})]},h)})})})},Ye=n=>{const[i,s]=a.useState(n||c.SYMMETRICAL);return{liquidityType:i,setLiquidityType:s}},pe=({testAddresses:n}={})=>{const{walletAddresses:i,isWalletLoading:s}=le(),p=a.useMemo(()=>{const u=Object.values(n||{});return u.length>0?u:i},[i,n]),{data:e,isFetching:t,isLoading:o,refetch:h}=xt(p,{skip:!p.length||s});return{data:e,refetch:h,isLoading:t||o}},ge=({assetString:n,liquidityType:i})=>{const{walletAddresses:s}=le(),{data:p,refetch:e,isLoading:t}=pe(),o=a.useMemo(()=>(p==null?void 0:p.find(({pool:S,runeAddress:g,assetAddress:M})=>S.toLowerCase()!==n.toLowerCase()?!1:i===c.SYMMETRICAL?s.includes(g)&&s.includes(M):!0))||{},[n,p,s,i]),h=a.useMemo(()=>Number.parseInt((o==null?void 0:o.runePending)||"0")>0,[o==null?void 0:o.runePending]),u=a.useMemo(()=>Number.parseInt((o==null?void 0:o.assetPending)||"0")>0,[o==null?void 0:o.assetPending]);return{lpMemberData:o,isRunePending:h,isAssetPending:u,refetch:e,isLoading:t}},he=({assets:n,fees:i,totalFee:s,poolShare:p,slippage:e,estimatedTime:t})=>{const o=n.map(u=>({label:`${d("views.liquidity.depositAmount")} ${u.asset.symbol}`,value:b.jsxs(N,{alignCenter:!0,justify:"between",children:[b.jsx(ne,{className:"mx-2",fontWeight:"semibold",children:u.value}),b.jsx(Mt,{asset:u.asset,size:24})]})})),h=i.map(u=>({label:`${u.chain==="THOR"?"THORChain":u.chain} ${d("common.fee")}`,value:b.jsx(Z,{tooltip:d("views.liquidity.chainFeeTooltip",{chain:u.chain==="THOR"?"THORChain":u.chain}),value:u.fee})}));return[...o,{label:d("views.wallet.slip"),value:b.jsx(Z,{tooltip:d("views.wallet.slippageTooltip"),value:e||"N/A"})},{label:d("views.liquidity.poolShareEstimated"),value:b.jsx(Z,{tooltip:d("views.liquidity.poolShareTooltip"),value:p})},...h,{label:d("views.wallet.totalFee"),value:b.jsx(Z,{tooltip:d("views.wallet.totalFeeTooltip"),value:s||"N/A"})},{label:d("views.wallet.estimatedTime"),value:b.jsx(Z,{tooltip:d("views.wallet.estimatedTimeTooltip"),value:t})}]},ie=n=>m.fromBigInt(BigInt(n),Dt.THOR),Ae=({depth:n,poolUnits:i,liquidityUnits:s})=>new m(n).mul(s).div(i).getValue("string"),fe=({runeAmount:n,assetAmount:i,runeDepth:s,assetDepth:p})=>{if(n==="0"&&i==="0"||s==="0"||p==="0")return 0;if(n==="0"||i==="0"){const g=m.fromBigInt(BigInt(s)),M=m.fromBigInt(BigInt(p)).div(g),I=new m(n),V=new m(i).div(M);if(I.eqValue(V))return 0;const _=V.gt(I)?V:I;return _.div(2).div(_.add(g)).mul(100).getValue("number")}const e=ie(s),t=ie(p),o=new m(i),h=new m(n),u=o.mul(e).sub(t.mul(h)),S=t.mul(h).add(e.mul(t));return Math.abs(u.div(S).mul(100).getValue("number"))},be=({runeDepth:n,assetDepth:i,liquidityUnits:s,runeAmount:p,assetAmount:e})=>{if(p==="0"&&e==="0")return 0;const t=new m({value:n,decimal:8}),o=new m({value:i,decimal:8}),h=new m({value:s,decimal:8}),u=new m(p).mul(10**8),S=new m(e).mul(10**8),g=u.mul(o),M=S.mul(t),I=u.mul(S),V=t.mul(o),_=h.mul(g.add(M.add(I.mul(2)))),T=g.add(M.add(V.mul(2))),H=_.div(T||1);return H.gt(0)?H.div(h||1).getValue("number"):0},ye=({assetAmount:n,runeAmount:i,runePriceInAsset:s,assetPriceInRune:p,minAssetAmount:e,minRuneAmount:t})=>{const o=i.mul(s);if(o.gt(n)){const S=n.lte(e)?e:n,g=i.lte(t)?t:i,M=Math.min(S.set(S.getValue("number")/s).getValue("number"),i.getValue("number")),I=Math.min(g.set(g.getValue("number")/p).getValue("number"),n.getValue("number"));return{maxSymAssetAmount:S.set(I),maxSymRuneAmount:n.set(M)}}const h=o.lte(e)?e:o,u=i.lte(t)?t:i;return{maxSymAssetAmount:h,maxSymRuneAmount:u}},ve={assetAddress:"",contract:"",symmetric:!1,lpProgressModal:!1,poolAddress:"",poolAssetValue:void 0,runeAddress:"",runeAssetValue:void 0},we=(n,{type:i,payload:s})=>{switch(i){case"setLpProgressModal":return{...n,lpProgressModal:s};case"setContract":return{...n,contract:s};case"setLPProgressState":return{...n,...s,lpProgressModal:!0};default:return n}},$e=({onAddLiquidity:n,skipWalletCheck:i,liquidityType:s,setLiquidityType:p,poolAsset:e,poolData:t,depositAssetsBalance:o,wallet:h})=>{const{hasWallet:u,getWallet:S}=le(),g=Ct(),{expertMode:M}=Rt(),{setIsConnectModalOpen:I}=It(),{isChainPauseLPAction:V}=Tt(),{getChainDepositLPPaused:_}=Lt(),{data:T}=Vt([P,e]),[H,J]=a.useReducer(we,ve),{isWalletAssetConnected:Se,runeBalance:Pe,maxRuneBalance:W,poolAssetBalance:xe,maxPoolAssetBalance:U}=o,$=a.useCallback(l=>S(l)||(h==null?void 0:h[l]),[S,h]),Me=a.useMemo(()=>V(e.chain)||_(e.chain),[V,e.chain,_]),{lpMemberData:r,isAssetPending:x,isRunePending:R}=ge({assetString:e.toString(),liquidityType:s}),E=a.useMemo(()=>s===c.SYMMETRICAL&&!M,[s,M]),[y,O]=a.useState(new m({value:0,decimal:8})),[v,F]=a.useState(new m({value:0,decimal:8})),[Ke,X]=a.useState(!1),[ze,oe]=a.useState(!1),[Ze,Ge]=a.useState(!0),{feeInUSD:Ce,inputFee:Re,outputFee:Je}=Ht({inputAsset:e,outputAsset:P}),Q=a.useMemo(()=>({runeAmount:v.getValue("string"),assetAmount:y.getValue("string"),runeDepth:(t==null?void 0:t.runeDepth)??"0",assetDepth:(t==null?void 0:t.assetDepth)??"0",liquidityUnits:(t==null?void 0:t.liquidityUnits)??"0",poolUnits:(t==null?void 0:t.units)??"0"}),[y,t==null?void 0:t.assetDepth,t==null?void 0:t.liquidityUnits,t==null?void 0:t.runeDepth,t==null?void 0:t.units,v]),D=Number.parseInt((t==null?void 0:t.assetDepth)||"0")/Number.parseInt((t==null?void 0:t.runeDepth)||"0"),k=Number.parseInt((t==null?void 0:t.runeDepth)||"0")/Number.parseInt((t==null?void 0:t.assetDepth)||"0"),Ie=a.useMemo(()=>`${fe(Q).toFixed(2)}%`,[Q]),Te=a.useMemo(()=>Et(be(Q)),[Q]),Y=a.useMemo(()=>{const l=!!$(e.chain),A=!!$(P.chain);return s===c.ASSET?l:(s===c.RUNE||l)&&A},[$,e.chain,s]),Le=a.useCallback(async l=>{const A=await Wt()||[],{router:w,halted:f}=A.find(L=>L.chain===l)||{};if(f&&!w)throw new Error("Trading & LP is temporarily halted, please try again later.");J({type:"setContract",payload:w||""})},[]);a.useEffect(()=>{Le(e.chain)},[Le,e.chain]);const{isApproved:Ve,isLoading:Xe}=$t({assetValue:e.set(y.getValue("string")),contract:H.contract,force:!0}),ee=a.useMemo(()=>e.toString(),[e]),Ee=a.useMemo(()=>{var w;const l=((w=T[ee])==null?void 0:w.price_usd)||0,A=x&&m.fromBigInt(BigInt((r==null?void 0:r.assetPending)||"0")).getValue("number")||y.getValue("number");return l*A},[T,ee,x,r==null?void 0:r.assetPending,y]),q=a.useMemo(()=>qe(j.THORChain),[]),B=a.useMemo(()=>Nt(e)?qe(e.chain):new m({value:0,decimal:8}),[e]),{maxSymAssetAmount:Ne,maxSymRuneAmount:_e}=a.useMemo(()=>t?ye(x&&r?{runeAmount:W,assetAmount:m.fromBigInt(BigInt(r.assetPending),8),runePriceInAsset:D,assetPriceInRune:k,minAssetAmount:B,minRuneAmount:q}:U&&R&&r?{runeAmount:m.fromBigInt(BigInt(r.runePending),8),assetAmount:U,runePriceInAsset:D,assetPriceInRune:k,minAssetAmount:B,minRuneAmount:q}:{runeAmount:W||m.fromBigInt(BigInt(0),8),assetAmount:U||m.fromBigInt(BigInt(0),8),runePriceInAsset:D,assetPriceInRune:k,minAssetAmount:B,minRuneAmount:q}):{maxSymAssetAmount:new m({value:0,decimal:8}),maxSymRuneAmount:new m({value:0,decimal:8})},[t,x,r,R,W,U,D,k,B,q]),Qe=a.useCallback(l=>{l===c.ASSET?F(new m({value:0,decimal:8})):l===c.RUNE&&O(new m({value:0,decimal:8})),p(l)},[p]),et=a.useCallback(l=>{if(!t){O(l);return}const A=E?Ne:U;A&&l.gt(A)&&!i?(O(new m({value:A.getValue("string"),decimal:8})),E&&F(new m({value:A.mul(k).getValue("string"),decimal:8}))):(O(l),E&&F(new m({value:l.mul(k).getValue("string"),decimal:8})))},[t,E,Ne,U,i,k]),tt=a.useCallback(l=>{if(!t){F(l);return}const A=E?_e:W;A&&l.gt(A)&&!i?(F(new m({value:A.getValue("string"),decimal:8})),E&&O(new m({value:A.mul(D).getValue("string"),decimal:8}))):(F(l),E&&O(l.mul(D)))},[t,E,_e,W,i,D]),st=a.useCallback(async()=>{var l;if(X(!1),n&&e&&s!==c.ASSET){n({poolAsset:e,runeAmount:P.set(v.getValue("string"))});return}if(u&&t){const A=s!==c.ASSET?P.set(v.getValue("string")):void 0,w=s!==c.RUNE?e.set(y.getValue("string")):void 0,f=me(),L=me();!R&&A&&g(re({id:f,label:d("txManager.addAmountAsset",{asset:P.ticker,amount:v.toSignificant(6)}),type:ae.TC_LP_ADD,inChain:j.THORChain})),!x&&w&&g(re({id:L,label:d("txManager.addAmountAsset",{asset:e.ticker,amount:y.toSignificant(6)}),type:ae.TC_LP_ADD,inChain:e.chain}));const yt=R||x||s===c.SYMMETRICAL,vt=R||x||s===c.SYMMETRICAL?{runeAddr:r==null?void 0:r.runeAddress,assetAddr:r==null?void 0:r.assetAddress}:{},wt=s===c.SYMMETRICAL?"sym":s===c.ASSET?"asset":"baseAsset",St={baseAssetValue:P.set(v.getValue("string")),assetValue:e.set(y.getValue("string")),isPendingSymmAsset:yt,mode:wt,poolIdentifier:"",...vt},{thorchain:De}=await(await ue(()=>import("./assets/index-POi8GhpC.js").then(async C=>(await C.__tla,C)).then(C=>C.hc),__vite__mapDeps([0,1]))).getSwapKitClient();if(!De)throw new Error("SwapKit client not found");try{const{runeTx:C,assetTx:z}=await De.addLiquidity(St);g(C!=="failed"&&typeof C=="string"?de({id:f,txid:C}):G({id:f,status:"error"})),g(z!=="failed"&&typeof z=="string"?de({id:L,txid:z}):G({id:L,status:"error"}))}catch(C){const z=((l=C==null?void 0:C.data)==null?void 0:l.originalError)||C.message;g(G({id:f,status:"error"})),g(G({id:L,status:"error"})),Be(d("notification.submitFail"),z,void 0,C)}}},[n,e,s,u,t,v,y,R,x,r==null?void 0:r.runeAddress,r==null?void 0:r.assetAddress,g]),nt=a.useCallback(async()=>{if(X(!1),u&&t){const l=s!==c.ASSET&&!R?P.set(v.getValue("string")):void 0,A=s!==c.RUNE&&!x?e.set(y.getValue("string")):void 0,{getAddress:w}=await(await ue(()=>import("./assets/index-POi8GhpC.js").then(async f=>(await f.__tla,f)).then(f=>f.hc),__vite__mapDeps([0,1]))).getSwapKitClient();J({type:"setLPProgressState",payload:{runeAssetValue:l,poolAssetValue:A,symmetric:s===c.SYMMETRICAL,poolAddress:e.toString(),runeAddress:w(j.THORChain),assetAddress:w(e.chain)}})}},[u,t,s,x,v,R,e,y]),at=a.useCallback(async()=>{if(oe(!1),Se(e)){const l=me(),A=e.chain===j.Ethereum?ae.ETH_APPROVAL:ae.AVAX_APPROVAL;g(re({id:l,type:A,label:`${d("txManager.approve")} ${e.ticker}`,inChain:e.chain}));const{thorchain:w}=await(await ue(()=>import("./assets/index-POi8GhpC.js").then(async f=>(await f.__tla,f)).then(f=>f.hc),__vite__mapDeps([0,1]))).getSwapKitClient();if(!w)throw new Error("SwapKit client not found");try{const f=await w.approveAssetValue({assetValue:e});typeof f=="string"&&g(de({id:l,txid:f}))}catch(f){_t(f),g(G({id:l,status:"error"})),Be(d("notification.approveFailed"),void 0,void 0,f)}}},[g,e,Se]),it=a.useCallback(()=>{if(!(Y||i))return je(d("notification.walletNotFound"),d("notification.connectWallet"));X(!0)},[Y,i]),ot=a.useCallback(()=>{u?oe(!0):je(d("notification.walletNotFound"),d("notification.connectWallet"))},[u]),lt=a.useMemo(()=>s===c.RUNE?[P]:s===c.ASSET?[e]:[e,P],[s,e]),rt=a.useMemo(()=>x||s===c.RUNE?[{asset:P,value:v.toSignificant(6)}]:R||s===c.ASSET?[{asset:e,value:y.toSignificant(6)}]:[{asset:P,value:v.toSignificant(6)},{asset:e,value:y.toSignificant(6)}],[x,s,R,v,e,y]),te=a.useMemo(()=>{if(Me)return{valid:!1,msg:d("notification.notAvailableDeposit")};if(s===c.SYMMETRICAL){if(!(v.gte(q)&&y.gte(B)))return{valid:!1,msg:d("notification.invalidAmount")};if(r&&(Number(r.assetPending)||Number(r.runePending))&&Number(r.runeAdded)&&!Number(r.assetAdded))return{valid:!1,msg:d("notification.alreadyHaveRune")}}return s===c.ASSET&&!y.gte(B)?{valid:!1,msg:d("notification.insufficientAmount")}:s===c.RUNE&&!v.gte(q)?{valid:!1,msg:d("notification.insufficientAmount")}:{valid:!0}},[r,Me,s,v,y,q,B]),K=a.useMemo(()=>!!$(e.chain)&&Ve===!1&&s!==c.RUNE,[$,Ve,s,e.chain]),ut=a.useMemo(()=>({asset:e,balance:xe,usdPrice:Ee,value:x&&r?m.fromBigInt(BigInt(r.assetPending),e.decimal):y}),[e,xe,Ee,x,r,y]),dt=a.useMemo(()=>{var w;const l=R&&r?m.fromBigInt(BigInt(r.runePending),8):v,A=((w=T[P.toString()])==null?void 0:w.price_usd)||0;return{asset:P,balance:Pe,usdPrice:A*l.getValue("number"),value:l}},[R,r,v,Pe,T]),mt=a.useMemo(()=>`Add ${e.ticker} Liquidity`,[e]),ct=a.useMemo(()=>te.valid?K?"Add":"Add Liquidity":te.msg,[te,K]),pt=a.useMemo(()=>{const l=s===c.RUNE;return Ft({amount:l?v:y,chain:l?j.THORChain:e.chain})},[s,y,v,e]),gt=he({assets:rt,poolShare:Te,slippage:Ie||"N/A",estimatedTime:pt,totalFee:Ce,fees:[{chain:e.chain,fee:Re.toSignificant()},{chain:j.THORChain,fee:Je.toSignificant()}]}),ht=Ot({assetName:e.ticker,assetValue:y.toSignificant(6),fee:Re.toSignificant()}),At=a.useMemo(()=>Y&&!K,[Y,K]),ft=a.useMemo(()=>{var f,L;const l=((f=T[P.toString()])==null?void 0:f.price_usd)||0,A=((L=T[ee])==null?void 0:L.price_usd)||.001,w=l/A;return Number.isNaN(w)?0:w},[ee,T]),bt=a.useCallback(l=>J({type:"setLpProgressModal",payload:l}),[J]);return{...H,addLiquiditySlip:Ie,approveConfirmInfo:ht,asymmTipVisible:Ze,btnLabel:ct,confirmInfo:gt,depositAssets:lt,feeInUSD:Ce,getEstimatedPoolShareForPoolDepth:Ae,handleAddLiquidity:it,handleApprove:ot,handleChangeAssetAmount:et,handleChangeRuneAmount:tt,handleConfirmAdd:st,handleConfirmProgressModal:nt,handleConfirmApprove:at,handleSelectLiquidityType:Qe,isApproveRequired:K,isAssetApproveLoading:Xe,isAssetPending:x,isDepositAvailable:At,isRunePending:R,isValidDeposit:te,isWalletConnected:Y,lpMemberData:r,poolAssetInput:ut,poolShareEst:Te,rate:ft,runeAssetInput:dt,setAsymmTipVisible:Ge,setIsConnectModalOpen:I,setLpProgressModal:bt,setVisibleApproveModal:oe,setVisibleConfirmModal:X,title:mt,visibleApproveModal:ze,visibleConfirmModal:Ke}},We=({assetRouteGetter:n=Bt}={})=>{const i=kt(),{assetParam:s}=qt(),[p,e]=a.useState();a.useEffect(()=>{(()=>{const o=s?Ue.from({asset:s}):Ue.from({chain:j.Bitcoin});e(o)})()},[s]);const t=a.useCallback(o=>{i(n(o))},[n,i]);return{poolAsset:p,assetParam:s,handleSelectPoolAsset:t}}});export{Fe as A,He as P,Kt as __tla,We as a,$e as b,Ye as u};
